<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>BDD Handschriften</title>
        <link rel="icon" type="image/png" href="../img/favicon.png" sizes="32x32">
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0 shrink-to-fit=no"/>
        <meta name="google" content="notranslate"/>
        
        <!--Bootstrap-->        
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script> 
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        
        
        <!-- // CSS -->
        <link rel="stylesheet" type="text/css" href="../CSS/style.css" media="screen"/>
        
        <!-- // External fonts -->
        <link href="https://fonts.googleapis.com/css?family=Cardo:400,700" rel="stylesheet"/>
        <link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet"/>
        
        
        <!-- // === Javascripts === -->
        <!-- // jquery -->
        <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>-->
        <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
        
        <!-- // Leaflet -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin=""/>
        <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
        
        <!-- // Leaflet subgroup Plugin -->
        <script src="https://unpkg.com/leaflet.featuregroup.subgroup@1.0.2/dist/leaflet.featuregroup.subgroup.js"></script>
        
        <!-- // Leaflet cluster Plugin -->
        <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js" crossorigin=""></script>
        <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" crossorigin=""/>
        <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" crossorigin=""/>
        
        <!--Fontawesome-->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer"/>

        <script src="../js/map.js"></script>
        <script src="../js/bdd_manuscriptdb.js"></script>
        <script src="../js/language.js"></script>
    </head>


    <body>
        <div id="navbar-placeholder"></div>
        <div class="back-button ps-4" style="margin-top:40px;">
          <button class="btn btn-outline-secondary rounded-circle hBack" type="button"><i class="fas fa-arrow-left"></i></button>
        </div>
        <div class="container">
            <h1 class="section-main-title"><span lang="de">HANDSCHRIFTEN</span><span lang="en">MANUSCRIPTS</span></h1>
            
        
            <div class="mss-table table-responsive">
                <table id="mss-table-1" style="width:100%" class="table table-hover">
                    <!-- Table headers -->
                    <thead>
                      <tr>
                        <th scope="col" class="heading" onclick="sortTable(0)">Signatur</th>
                        <th scope="col" class="heading" onclick="sortTable(1)">Sigle</th>
                        <th scope="col" class="heading" onclick="sortTable(2)">Entstehungsort</th>
                        <th scope="col" class="heading" onclick="sortTable(3)">Entstehungszeit</th>
                      </tr>
                    </thead>
                    <!-- Filter inputs -->
                    <thead>
                      <tr>
                        <th class="mss-filter-table">
                          <input type="text" class="mss-filter" id="mss-filter-1" onkeyup="filterMss('1')" placeholder="Eingabe für Filter"/>
                        </th>
                        <th class="mss-filter-table">
                          <input type="text" class="mss-filter" id="mss-filter-2" onkeyup="filterMss('2')" placeholder="Eingabe für Filter"/>
                        </th>
                        <th class="mss-filter-table">
                          <input type="text" class="mss-filter" id="mss-filter-3" onkeyup="filterMss('3')" placeholder="Eingabe für Filter"/>
                        </th>
                        <th class="mss-filter-table">
                          <input type="text" class="mss-filter" id="mss-filter-4" onkeyup="filterMss('4')" placeholder="Eingabe für Filter"/>
                        </th>
                      </tr>
                    </thead>
                    <!-- Table body for data -->
                    <tbody id="table-body">
                      <!-- Table rows will be dynamically added here -->
                    </tbody>
                  </table>

            </div>
            
            <div class="mss-map-head">
                <h4 style="margin-top:40px; margin-bottom:40px" lang="de">KARTENANSICHT</h4>
                <h4 style="margin-top:40px; margin-bottom:40px" lang="en">MAP VIEW</h4>
            </div>
            <div class="mss-map" id="map1"></div>
        </div>

        <div id="footer-placeholder"></div>

    </body>
    
    <!--Display Navbar, Footer, back button-->
    <script>
      $(function() {
          function setActiveNavItem() {
              var path = window.location.pathname; 
              var currentPage = path.split("/").pop();
              $(".nav-item a").removeClass("active");
              
              $(".nav-item a").each(function() {
                  var href = $(this).attr("href");
                  if (href && currentPage === href.split("/").pop()) {
                      $(this).addClass("active");
                  }
              });
          }

          $("#navbar-placeholder").load("navbar.html", function() {
              setActiveNavItem();
              checkLanguage();
          });
      });
    
        $(function(){
            $("#footer-placeholder").load("footer.html", function(){checkLanguage()});
        });
    
            $(".hBack").on("click", function(e){
                e.preventDefault();
                window.history.back();
            });
        </script>

    <!--Embedding map -->
    <script type="text/javascript">
    var mymap = L.map('map1').setView([48.00, 12], 5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(mymap);
    </script>
   

    <!--data in ms-table-->
    <script>
        async function fetchDataAndPopulateTable() {
          try {
            const list_ms = ["B", "F", "K", "V1", "V2"]
            for (var ms in list_ms){
                const folderPath = '../data/mss/' + list_ms[ms] + '/Tei/v1'; // Update this with your XML folder path
                const response = await fetch(folderPath + '/msdesc.xml'); // Fetch the XML file
                if (response.ok) {
                    const xmlText = await response.text();
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(xmlText, 'text/xml');

                    const msNameFull = xmlDoc.querySelectorAll('msName[type="full"]')[0].innerHTML
                    const msNameSigle = xmlDoc.querySelectorAll('msName[type="sigle"]')[0].innerHTML
                    //const origPlace = xmlDoc.querySelectorAll('origPlace')[0].textContent 
                    //const origPlace = xmlDoc.querySelector('origPlace').childNodes[0].textContent.trim(); //This shows only Worms
                    const origPlaceElement = xmlDoc.querySelector('origPlace');
                    const origPlaceText = Array.from(origPlaceElement.childNodes)
                        .filter(node => node.nodeName !== 'location' || node.nodeName === 'location' && node.childNodes.length === 0)
                        .map(node => node.textContent.trim())
                        .join(' ');

                    const origDate = xmlDoc.querySelectorAll('origDate')[0].innerHTML
            
                    const tableBody = document.getElementById('table-body');
                    const row = document.createElement('tr');
                    const cell1 = document.createElement('td');
                    const cell2 = document.createElement('td');
                    const cell3 = document.createElement('td');
                    const cell4 = document.createElement('td');
                    //const document_id = xmlDoc.querySelectorAll('msDesc')[0].getAttribute("xml:id").replace("-msdesc","")
            
                    cell1.innerHTML = "<a href='ms-item.html?document="+ list_ms[ms] + "'>" + msNameFull + "</a>";
                    cell2.textContent = msNameSigle;
                    cell3.textContent = origPlaceText;
                    cell4.textContent = origDate;
            
                    row.appendChild(cell1);
                    row.appendChild(cell2);
                    row.appendChild(cell3);
                    row.appendChild(cell4);
            
                    tableBody.appendChild(row);
                } else {
                    console.error('Failed to fetch XML file.');
                }
            }
          } catch (error) {
            console.error('Error:', error);
          }
        }
    
        // Invoke the function when the page loads
        window.onload = fetchDataAndPopulateTable;
      </script>
</html>