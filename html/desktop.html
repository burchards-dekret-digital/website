<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Schreibtisch</title>
        <link rel="icon" type="image/png" href="../img/favicon.png" sizes="32x32">
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <meta name="google" content="notranslate"/>
        
        <!--Bootstrap-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"/>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
        
        

        <!-- // External fonts -->
        <link href="https://fonts.googleapis.com/css?family=Cardo:400,700" rel="stylesheet"/>
        <link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet"/>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500"/>
        
        <!-- // === Javascripts === -->
        <!-- // jquery -->
        <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>-->
        <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
        
        <!-- // CSS -->
        <link rel="stylesheet" type="text/css" href="../CSS/style.css" media="screen"/>
        
        <!--Fontawesome-->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer"/>
        
        <script src="../js/language.js" defer></script>

       

        <style>
           .resource-panel-item {
                flex: 0 0 calc(50% - 10px); 
                max-width: calc(50% - 10px); 
                margin-right: 10px;
                margin-bottom: 20px;
            }

            .resource-panel-item.only-child {
                flex: 0 0 100%;
                max-width: 100%;
            }

            .btn-outline-primary {
            background-color: transparent;
            color: #0d6efd;
            border-color: #0d6efd;
            }

        </style>
    </head>
    <body>

        <div id="navbar-placeholder"></div>
                
        <div id="content" class="container">
            <div class="back-button" style="margin-top:40px;">
                <button class="btn btn-outline-secondary rounded-circle hBack" type="button"><i class="fas fa-arrow-left"></i></button>
            </div>

            <h1 style="margin-top:30px; margin-bottom:40px;"><span lang="de">SCHREIBTISCH</span></h1>
            <h1 style="margin-top:20px; margin-bottom:40px;"><span lang="en">DESKTOP</span></h1>

            <button class="btn btn-primary" id="addResourceBtn">Add Resource</button>
            <button class="btn btn-success" id="downloadJsonBtn">Download JSON</button>
            <div class="row mt-3">
                <div class="col">
                    <div class="overflow-auto d-flex" id="resourcePanel"></div>
                </div>
            </div>


            <!-- Modal for selecting resources -->
            <div class="modal fade" id="resourceModal" tabindex="-1" aria-labelledby="resourceModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                    <h5 class="modal-title" id="resourceModalLabel">Select Resources</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="modal-body">
                            <h6>Load JSON</h6>
                            <input type="file" class="form-control" id="jsonFileInput" accept=".json">
                            
                        </div>
                        <div class="accordion" id="accordionManuscripts">
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="manuscriptAHeader">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseManuscriptA" aria-expanded="true" aria-controls="collapseManuscriptA">
                                    Manuscript A
                                    </button>
                                </h2>
                                <div id="collapseManuscriptA" class="accordion-collapse collapse show" aria-labelledby="manuscriptAHeader" data-bs-parent="#accordionManuscripts">
                                    <div class="accordion-body">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="Manuscript A-Book 1" id="manuscriptABook1">
                                            <label class="form-check-label" for="manuscriptABook1">
                                            Book 1
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="Manuscript A-Book 2" id="manuscriptABook2">
                                            <label class="form-check-label" for="manuscriptABook2">
                                            Book 2
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="Manuscript A-Book 3" id="manuscriptABook3">
                                            <label class="form-check-label" for="manuscriptABook3">
                                            Book 3
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                </div>
                                <div class="accordion-item">
                                <h2 class="accordion-header" id="manuscriptBHeader">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseManuscriptB" aria-expanded="false" aria-controls="collapseManuscriptB">
                                    Manuscript B
                                    </button>
                                </h2>
                                <div id="collapseManuscriptB" class="accordion-collapse collapse" aria-labelledby="manuscriptBHeader" data-bs-parent="#accordionManuscripts">
                                    <div class="accordion-body">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="Manuscript B-Book 1" id="manuscriptBBook1">
                                        <label class="form-check-label" for="manuscriptBBook1">
                                        Book 1
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="Manuscript B-Book 2" id="manuscriptBBook2">
                                        <label class="form-check-label" for="manuscriptBBook2">
                                        Book 2
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="Manuscript B-Book 3" id="manuscriptBBook3">
                                        <label class="form-check-label" for="manuscriptBBook3">
                                        Book 3
                                        </label>
                                    </div>
                                    </div>
                                </div>
                                </div>
                                <div class="accordion-item">
                                <h2 class="accordion-header" id="manuscriptCHeader">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseManuscriptC" aria-expanded="false" aria-controls="collapseManuscriptC">
                                    Manuscript C
                                    </button>
                                </h2>
                                <div id="collapseManuscriptC" class="accordion-collapse collapse" aria-labelledby="manuscriptCHeader" data-bs-parent="#accordionManuscripts">
                                    <div class="accordion-body">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="Manuscript C-Book 1" id="manuscriptCBook1">
                                        <label class="form-check-label" for="manuscriptCBook1">
                                        Book 1
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="Manuscript C-Book 2" id="manuscriptCBook2">
                                        <label class="form-check-label" for="manuscriptCBook2">
                                        Book 2
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="Manuscript C-Book 3" id="manuscriptCBook3">
                                        <label class="form-check-label" for="manuscriptCBook3">
                                        Book 3
                                        </label>
                                    </div>
                                    <!-- Aggiungere qui le altre alternative per i libri -->
                                    </div>
                                </div>
                                </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="confirmSelectionBtn">Confirm Selection</button>
                    </div>
                </div>
                </div>
            </div>

        </div>

        <div id="footer-placeholder"></div>
        
    </body>

    
    <script>
      //Display Navbar with active item 
      $(function() {
          function setActiveNavItem() {
              var path = window.location.pathname; 
              var currentPage = path.split("/").pop();
              $(".nav-item a").removeClass("active");
              
              $(".nav-item a").each(function() {
                  var href = $(this).attr("href");
                  if (href && currentPage === href.split("/").pop()) {
                      $(this).addClass("active");
                  }
              });
          }

          $("#navbar-placeholder").load("navbar.html", function() {
              setActiveNavItem();
              checkLanguage();
          });
      });
    //Display Footer
        $(function(){
            $("#footer-placeholder").load("footer.html", function(){checkLanguage()});
        });
    //back button
        $(".hBack").on("click", function(e){
            e.preventDefault();
            window.history.back();
        });
    </script>
    
   <!--CODICE DEL 12.03.24-->
      <!--<script>
        document.getElementById('addResourceBtn').addEventListener('click', function() {
          $('#resourceModal').modal('show');
        });
      
        document.getElementById('jsonFileInput').addEventListener('change', function() {
          const file = this.files[0];
          const reader = new FileReader();
          reader.onload = function(event) {
            const jsonData = JSON.parse(event.target.result);
            displayResourcesFromJson(jsonData);
          };
          reader.readAsText(file);
        });
      
        document.getElementById('confirmSelectionBtn').addEventListener('click', function() {
          $('#resourceModal').modal('hide');
          displaySelectedResources();
        });


        function displayResourcesFromJson(jsonData) {
            const resourcePanel = document.getElementById('resourcePanel');
            resourcePanel.innerHTML = '';

            for (const [manuscriptId, data] of Object.entries(jsonData)) {
                const { id: bookId, view } = data;
                const title = `Manuscript - ${bookId}`;
                const transcriptions = [];

                if (view.transcription) transcriptions.push('Transcription');
                if (view.structure) transcriptions.push('Structure');
                if (view.mirador) transcriptions.push('Mirador');
                
                const panel = createResourcePanel(title, transcriptions);
                resourcePanel.appendChild(panel);
            }

            adjustPanelWidth();
            }


      
        function displaySelectedResources() {
            const resourcePanel = document.getElementById('resourcePanel');

            const manuscriptABooks = document.querySelectorAll('#collapseManuscriptA input[type="checkbox"]:checked');
            const manuscriptBBooks = document.querySelectorAll('#collapseManuscriptB input[type="checkbox"]:checked');
            const manuscriptCBooks = document.querySelectorAll('#collapseManuscriptC input[type="checkbox"]:checked');

            // Add new panel without removing the ones already present
            appendBooks(resourcePanel, manuscriptABooks);
            appendBooks(resourcePanel, manuscriptBBooks);
            appendBooks(resourcePanel, manuscriptCBooks);

            adjustPanelWidth();
        }

        function appendBooks(container, books) {
            books.forEach(book => {
                const [manuscript, bookNumber] = book.value.split('-');
                const panel = createResourcePanel(`${manuscript} - ${bookNumber}`, [`Transcription of ${bookNumber}`]);
                container.appendChild(panel);
            });
        }

      
        function createResourcePanel(title, transcriptions) {
          const panel = document.createElement('div');
          panel.classList.add('resource-panel-item');
      
          const panelContent = `
            <div class="card">
              <div class="card-header d-flex justify-content-between align-items-center">
                <span>${title}</span>
                <div>
                  <button type="button" class="btn btn-primary btn-sm me-2 add-transcription-btn">Transcription</button>
                  <button type="button" class="btn btn-outline-primary btn-sm me-2 add-structure-btn">Structure</button>
                  <button type="button" class="btn btn-outline-primary btn-sm mirador-btn">Mirador</button>
                </div>
                <button type="button" class="btn-close" aria-label="Close"></button>
              </div>
              <div class="card-body row">
                ${transcriptions.map(transcription => `
                  <div class="col border m-1">${transcription}</div>
                `).join('')}
              </div>
            </div>
          `;
          panel.innerHTML = panelContent;
      
          panel.querySelector('.btn-close').addEventListener('click', function() {
            panel.remove();
            adjustPanelWidth();
          });
      
          let transcriptionAdded = true;
          let structureAdded = false;
          let miradorAdded = false;
      
          const addTranscriptionBtn = panel.querySelector('.add-transcription-btn');
          addTranscriptionBtn.addEventListener('click', function() {
            if (!transcriptionAdded) {
              panel.querySelector('.card-body').innerHTML += '<div class="col border m-1">Transcription</div>';
              transcriptionAdded = true;
              addTranscriptionBtn.classList.remove('btn-outline-primary');
              addTranscriptionBtn.classList.add('btn-primary');
            } else {
              panel.querySelector('.card-body .col:last-child').remove();
              transcriptionAdded = false;
              addTranscriptionBtn.classList.remove('btn-primary');
              addTranscriptionBtn.classList.add('btn-outline-primary');
            }
          });
      
          const addStructureBtn = panel.querySelector('.add-structure-btn');
          addStructureBtn.addEventListener('click', function() {
            if (!structureAdded) {
              panel.querySelector('.card-body').innerHTML += '<div class="col border m-1">Structure</div>';
              structureAdded = true;
              addStructureBtn.classList.remove('btn-outline-primary');
              addStructureBtn.classList.add('btn-primary');
            } else {
              panel.querySelector('.card-body .col:last-child').remove();
              structureAdded = false;
              addStructureBtn.classList.remove('btn-primary');
              addStructureBtn.classList.add('btn-outline-primary');
            }
          });
      
          const miradorBtn = panel.querySelector('.mirador-btn');
          miradorBtn.addEventListener('click', function() {
            if (!miradorAdded) {
              panel.querySelector('.card-body').innerHTML += '<div class="col border m-1">Mirador Viewer</div>';
              miradorAdded = true;
              miradorBtn.classList.remove('btn-outline-primary');
              miradorBtn.classList.add('btn-primary');
            } else {
              panel.querySelector('.card-body .col:last-child').remove();
              miradorAdded = false;
              miradorBtn.classList.remove('btn-primary');
              miradorBtn.classList.add('btn-outline-primary');
            }
          });
      
          return panel;
        }
      
        //panel width
        function adjustPanelWidth() {
          const resourcePanel = document.getElementById('resourcePanel');
          const resourceCount = resourcePanel.children.length;
          const panels = resourcePanel.getElementsByClassName('resource-panel-item');
      
          if (resourceCount === 1) {
            panels[0].classList.add('only-child');
          } else {
            Array.from(
      
      panels).forEach(panel => {
              panel.classList.remove('only-child');
            });
          }
        }
      
        //Upload json
        document.getElementById('downloadJsonBtn').addEventListener('click', function() {
          const resourceOptions = {};
      
          const resourcePanels = document.querySelectorAll('.resource-panel-item');
      
          resourcePanels.forEach((panel, index) => {
            const manuscriptId = index + 1;
            const bookId = panel.querySelector('.card-header span').textContent.split(' - ')[1];
            const view = {
              transcription: panel.querySelector('.add-transcription-btn').classList.contains('btn-primary'),
              structure: panel.querySelector('.add-structure-btn').classList.contains('btn-primary'),
              mirador: panel.querySelector('.mirador-btn').classList.contains('btn-primary')
            };
            resourceOptions[manuscriptId] = { id: bookId, view: view };
          });
      
          downloadJson(resourceOptions);
        });

      //Download json
        function downloadJson(data) {
          const filename = 'resource_options.json';
          const json = JSON.stringify(data, null, 2);
          const blob = new Blob([json], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = filename;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        }
      </script>-->


  <script>
  document.getElementById('addResourceBtn').addEventListener('click', function() {
    $('#resourceModal').modal('show');
  });

  document.getElementById('jsonFileInput').addEventListener('change', function() {
    const file = this.files[0];
    const reader = new FileReader();
    reader.onload = function(event) {
      const jsonData = JSON.parse(event.target.result);
      displayResourcesFromJson(jsonData);
      saveResourceState(); // Save resource panel status after uploading data from Json
    };
    reader.readAsText(file);
  });

  document.getElementById('confirmSelectionBtn').addEventListener('click', function() {
    $('#resourceModal').modal('hide');
    displaySelectedResources();
    saveResourceState(); // Save resource panel status after selection
  });

  // After function displaySelectedResources() --> save resource panel status in local storage
  function saveResourceState() {
    const resourcePanels = document.querySelectorAll('.resource-panel-item');
    const resourceState = [];

    resourcePanels.forEach(panel => {
      const bookId = panel.querySelector('.card-header span').textContent.split(' - ')[1];
      const view = {
        transcription: panel.querySelector('.add-transcription-btn').classList.contains('btn-primary'),
        structure: panel.querySelector('.add-structure-btn').classList.contains('btn-primary'),
        mirador: panel.querySelector('.mirador-btn').classList.contains('btn-primary')
      };
      resourceState.push({ bookId, view });
    });

    localStorage.setItem('resourceState', JSON.stringify(resourceState));
  }

  // Upload source panel status from local storage
  function loadResourceState() {
    const resourceState = JSON.parse(localStorage.getItem('resourceState'));

    if (resourceState) {
      const resourcePanel = document.getElementById('resourcePanel');
      resourcePanel.innerHTML = '';

      resourceState.forEach(state => {
        const { bookId, view } = state;
        const transcriptions = [];

        if (view.transcription) transcriptions.push('Transcription');
        if (view.structure) transcriptions.push('Structure');
        if (view.mirador) transcriptions.push('Mirador');

        const panel = createResourcePanel(`Manuscript - ${bookId}`, transcriptions);
        resourcePanel.appendChild(panel);
      });

      adjustPanelWidth();
    }
  }

  // Call function loadResourceState() when loading the page
  window.addEventListener('load', loadResourceState);

  function displayResourcesFromJson(jsonData) {
    const resourcePanel = document.getElementById('resourcePanel');
    resourcePanel.innerHTML = '';

    for (const [manuscriptId, data] of Object.entries(jsonData)) {
      const { id: bookId, view } = data;
      const title = `Manuscript - ${bookId}`;
      const transcriptions = [];

      if (view.transcription) transcriptions.push('Transcription');
      if (view.structure) transcriptions.push('Structure');
      if (view.mirador) transcriptions.push('Mirador');

      const panel = createResourcePanel(title, transcriptions);
      resourcePanel.appendChild(panel);
    }

    adjustPanelWidth();
  }

  function displaySelectedResources() {
    const resourcePanel = document.getElementById('resourcePanel');

    const manuscriptABooks = document.querySelectorAll('#collapseManuscriptA input[type="checkbox"]:checked');
    const manuscriptBBooks = document.querySelectorAll('#collapseManuscriptB input[type="checkbox"]:checked');
    const manuscriptCBooks = document.querySelectorAll('#collapseManuscriptC input[type="checkbox"]:checked');

    // Add new panel without removing the ones already present
    appendBooks(resourcePanel, manuscriptABooks);
    appendBooks(resourcePanel, manuscriptBBooks);
    appendBooks(resourcePanel, manuscriptCBooks);

    adjustPanelWidth();
  }


  function appendBooks(container, books) {
    books.forEach(book => {
      const [manuscript, bookNumber] = book.value.split('-');
      const panel = createResourcePanel(`${manuscript} - ${bookNumber}`, [`Transcription of ${bookNumber}`]);
      container.appendChild(panel);
    });
  }
  

  function createResourcePanel(title, transcriptions) {
    const panel = document.createElement('div');
    panel.classList.add('resource-panel-item');

    const panelContent = `
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <span>${title}</span>
          <div>
            <button type="button" class="btn btn-primary btn-sm me-2 add-transcription-btn">Transcription</button>
            <button type="button" class="btn btn-outline-primary btn-sm me-2 add-structure-btn">Structure</button>
            <button type="button" class="btn btn-outline-primary btn-sm mirador-btn">Mirador</button>
          </div>
          <button type="button" class="btn-close" aria-label="Close"></button>
        </div>
        <div class="card-body row">
          ${transcriptions.map(transcription => `
            <div class="col border m-1">${transcription}</div>
          `).join('')}
        </div>
      </div>
    `;
    panel.innerHTML = panelContent;

    panel.querySelector('.btn-close').addEventListener('click', function() {
      panel.remove();
      adjustPanelWidth();
      saveResourceState(); //Save source panel status after removing one panel
    });

    let transcriptionAdded = true;
    let structureAdded = false;
    let miradorAdded = false;

    const addTranscriptionBtn = panel.querySelector('.add-transcription-btn');
    addTranscriptionBtn.addEventListener('click', function() {
      if (!transcriptionAdded) {
        panel.querySelector('.card-body').innerHTML += '<div class="col border m-1">Transcription</div>';
        transcriptionAdded = true;
        addTranscriptionBtn.classList.remove('btn-outline-primary');
        addTranscriptionBtn.classList.add('btn-primary');
      } else {
        panel.querySelector('.card-body .col:last-child').remove();
        transcriptionAdded = false;
        addTranscriptionBtn.classList.remove('btn-primary');
        addTranscriptionBtn.classList.add('btn-outline-primary');
      }
      saveResourceState(); // Save resource panel status after addition/deletion transcription
    });

    const addStructureBtn = panel.querySelector('.add-structure-btn');
    addStructureBtn.addEventListener('click', function() {
      if (!structureAdded) {
        panel.querySelector('.card-body').innerHTML += '<div class="col border m-1">Structure</div>';
        structureAdded = true;
        addStructureBtn.classList.remove('btn-outline-primary');
        addStructureBtn.classList.add('btn-primary');
      } else {
        panel.querySelector('.card-body .col:last-child').remove();
        structureAdded = false;
        addStructureBtn.classList.remove('btn-primary');
        addStructureBtn.classList.add('btn-outline-primary');
      }
      saveResourceState(); //Save resource panel status after addtion/deletion structure
    });

    const miradorBtn = panel.querySelector('.mirador-btn');
    miradorBtn.addEventListener('click', function() {
      if (!miradorAdded) {
        panel.querySelector('.card-body').innerHTML += '<div class="col border m-1">Mirador Viewer</div>';
        miradorAdded = true;
        miradorBtn.classList.remove('btn-outline-primary');
        miradorBtn.classList.add('btn-primary');
      } else {
        panel.querySelector('.card-body .col:last-child').remove();
        miradorAdded = false;
        miradorBtn.classList.remove('btn-primary');
        miradorBtn.classList.add('btn-outline-primary');
      }
      saveResourceState(); //Save resource panel status after addtion/deletion Mirador Viewer
    });

    return panel;
  }


  // Add a listener for messages from ms-item
  window.addEventListener("message", receiveMessage, false);
  function receiveMessage(event) {
      if (event.origin !== window.location.origin) return;
      if (event.data) {
          // add new resource panel to desktop.html
          var selectedBook = event.data;
          appendSelectedBookToDesktop(selectedBook);
      }
  }

  function appendSelectedBookToDesktop(selectedBook) {
      var manuscript = selectedBook.split('-')[0];
      var bookNumber = selectedBook.split('-')[1];
      var panel = createResourcePanel(`${manuscript} - ${bookNumber}`, [`Transcription of ${bookNumber}`]);
      var container = document.getElementById('resourcePanel');
      container.appendChild(panel);
      // Save updated state in localStorage
      saveResourceState();
  }

  //panel width
  function adjustPanelWidth() {
    const resourcePanel = document.getElementById('resourcePanel');
    const resourceCount = resourcePanel.children.length;
    const panels = resourcePanel.getElementsByClassName('resource-panel-item');

    if (resourceCount === 1) {
      panels[0].classList.add('only-child');
    } else {
      Array.from(panels).forEach(panel => {
        panel.classList.remove('only-child');
      });
    }
  }


  //Upload json
  document.getElementById('downloadJsonBtn').addEventListener('click', function() {
    const resourceOptions = {};

    const resourcePanels = document.querySelectorAll('.resource-panel-item');

    resourcePanels.forEach((panel, index) => {
      const manuscriptId = index + 1;
      const bookId = panel.querySelector('.card-header span').textContent.split(' - ')[1];
      const view = {
        transcription: panel.querySelector('.add-transcription-btn').classList.contains('btn-primary'),
        structure: panel.querySelector('.add-structure-btn').classList.contains('btn-primary'),
        mirador: panel.querySelector('.mirador-btn').classList.contains('btn-primary')
      };
      resourceOptions[manuscriptId] = { id: bookId, view: view };
    });

    downloadJson(resourceOptions);
    saveResourceState(); //Save resource panel status before downloading json file
  });

  //Download json
  function downloadJson(data) {
    const filename = 'resource_options.json';
    const json = JSON.stringify(data, null, 2);
    const blob = new Blob([json], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }
</script>



</html>