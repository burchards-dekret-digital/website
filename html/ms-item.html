<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml">
        <head>
            <title>Manuscript</title>
            <meta name="keywords" content="Decretum Burchardi Manuscript">
            <meta name="description" content="Explore the manuscript from the Decretum Burchardi. View detailed metadata, digitized images and map location for in-depth research.">
            <link rel="icon" type="image/png" href="../img/favicon.png" sizes="32x32">
            <meta charset="UTF-8"/>
            <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
            <meta name="google" content="notranslate"/>    

            <link href="../CSS/bootstrap.min.css" rel="stylesheet">
            <script src="../js/bootstrap.bundle.min.js"></script>

            <script src="../js/mirador-3.3.0.min.js"></script>
            
            <!--Leaflet-->
            <link rel="stylesheet" href="../CSS/leaflet.css">
            <script src="../js/leaflet.js"></script>
            <script src="../js/leaflet.featuregroup.subgroup.js"></script>
            <script src="../js/leaflet.markercluster.js"></script>
            <link rel="stylesheet" href="../CSS/MarkerCluster.css">
            <link rel="stylesheet" href="../CSS/MarkerCluster.Default.css">

            <link rel="stylesheet" href="../CSS/all.min.css"><!--Fontawesome-->
            <link rel="stylesheet" type="text/css" href="../CSS/style.css" media="screen"/>
            
            <script src="../js/jquery-3.7.1.min.js"></script>
            <script src="../js/language.js"></script>
            <script src="../js/navigation.js" defer></script>
        </head>
        <body>
            <div id="navbar-placeholder"></div>

            <div class="back-button ps-4 mt-5">
                <button class="btn btn-outline-secondary rounded-circle hBack" type="button"><i class="fas fa-arrow-left"></i></button>
            </div>
            
            <div class="container mss-item-view" style="flex:1">
                <div class="mss-data">
                        <div class="row">
                            
                            <!--COLUMN 1: CONTENT-->
                            <div class="col-sm-6">
                                <div class="mb-3">
                                    <h1 class="section-main-title"><div id="ms-title"></div></h1>
                                </div>
                                <div class="mb-3 d-flex flex-column flex-md-row">
                                    <h4 class="mt-2 me-2 text-uppercase"><span lang="de">Buch auswählen</span><span lang="en">Select a book</span></h4>
                                    <select class="form-select" id="book-selector">
                                        <option val="" disabled="" selected=""></option>
                                    </select>
                                    <button id="addToDesk" type="button" class="btn btn-primary mt-3 mt-md-0 ms-md-3" disabled><span lang="de">Buch zum Schreibtisch hinzufügen</span><span lang="en">Add book to Desktop</span></button>
                                </div>

                                

                                <div class="accordion" id="accordionInfo">
                                    
                                    <!--SIGNATUR-->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingIdno">
                                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseIdno" aria-expanded="true" aria-controls="collapseIdno">
                                                <h4><span lang="de">SIGNATUR</span><span lang="en">SIGNATURE</span></h4>
                                            </button>
                                        </h2>
                                        <div id="collapseIdno" class="accordion-collapse collapse show" aria-labelledby="headingIdno">
                                            <div class="accordion-body">
                                                <div class="ms_desc">
                                                    <div id="mss-signatur"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!--GESCHICHTE-->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingGeschichte">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseGeschichte" aria-expanded="false" aria-controls="collapseGeschichte">
                                                <h4><span lang="de">GESCHICHTE</span><span lang="en">HISTORY</span></h4>
                                            </button>
                                        </h2>
                                        <div id="collapseGeschichte" class="accordion-collapse collapse" aria-labelledby="headingGeschichte">
                                            <div class="accordion-body">
                                                <div id="mss-history"></div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!--BESCHREIBUNG-->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingBeschreibung">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseBeschreibung" aria-expanded="false" aria-controls="collapseBeschreibung">
                                                <h4><span lang="de">BESCHREIBUNG</span><span lang="en">DESCRIPTION</span></h4>
                                            </button>
                                        </h2>
                                        <div id="collapseBeschreibung" class="accordion-collapse collapse" aria-labelledby="headingBeschreibung">
                                            <div class="accordion-body">
                                                <div class="ms_desc">
                                                    <div id="mss-desc"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!--INHALT UND HINZUFÜGEN-->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingInhalt">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInhalt" aria-expanded="false" aria-controls="collapseInhalt">
                                                <h4><span lang="de">INHALT UND BINDUNG</span><span lang="en">CONTENT AND BINDING</span></h4>
                                            </button>
                                        </h2>
                                        <div id="collapseInhalt" class="accordion-collapse collapse" aria-labelledby="headingInhalt">
                                            <div class="accordion-body">
                                                <div class="ms_desc">
                                                    <h5><span lang="de">INHALT</span><span lang="en">CONTENT</span></h5>
                                                    <div id="mss-content"></div>
                                                    
                                                    <h5 class="mt-5"><span lang="de">MODERNE BINDUNG</span><span lang="en">MODERN BINDING</span></h5>
                                                    <div id="mss-content-struct-modern"></div> 
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!--KATALOGE-->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingKataloge">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseKataloge" aria-expanded="false" aria-controls="collapseKataloge">
                                                <h4><span lang="de">KATALOGE</span><span lang="en">CATALOGUE</span></h4>
                                            </button>
                                        </h2>
                                        <div id="collapseKataloge" class="accordion-collapse collapse" aria-labelledby="headingKataloge">
                                            <div class="accordion-body">
                                                <div class="ms_desc">
                                                    <div id="mss-catalogue">
                                                        <ul id="catalogue-list"></ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!--WEITERFÜHRENDE LITERATUR-->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingLiterature">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseLiterature" aria-expanded="false" aria-controls="collapseLiterature">
                                                <h4><span lang="de">WEITERFÜHRENDE LITERATUR</span><span lang="en">FURTHER LITERATURE</span></h4>
                                            </button>
                                        </h2>
                                        <div id="collapseLiterature" class="accordion-collapse collapse" aria-labelledby="headingLiterature">
                                            <div class="accordion-body">
                                                <div class="ms_desc">
                                                    <div id="mss-literature">
                                                        <ul id="literature-list"></ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!--WERESOURCEN-->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingWebressourcen">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseWebressourcen" aria-expanded="false" aria-controls="collapseWebressourcen">
                                                <h4><span lang="de">WEBRESOURCEN</span><span lang="en">WEB RESOURCES</span></h4>
                                            </button>
                                        </h2>
                                        <div id="collapseWebressourcen" class="accordion-collapse collapse" aria-labelledby="headingWebressourcen">
                                            <div class="accordion-body">
                                                <div class="ms_desc">
                                                    <div class="btn-group" role="group">
                                                        <a id="webResourceDigitalisat" href="" target="_blank" class="btn btn-outline-primary"><span lang="de">Digitalisat</span><span lang="en">Digital copy</span></a>
                                                        <a id="webResourceKatalogisat" href="" target="_blank" class="btn btn-outline-primary"><span lang="de">Katalogisat</span><span lang="en">Catalogue entry</span></a>
                                                        <div class="btn-group dropup" role="group">
                                                            <button type="button" class="btn btn-outline-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                                                                <span lang="de">XML-Datei</span><span lang="en">XML file</span>
                                                            </button>
                                                            <ul class="dropdown-menu">
                                                                <li><a class="dropdown-item" href="" target="_blank" hidden><span lang="de">Buch 00</span><span lang="en">Book 00</span></a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank"><span lang="de">Buch 01</span><span lang="en">Book 01</span></a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank" hidden><span lang="de">Buch 02</span><span lang="en">Book 02</span></a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank" hidden><span lang="de">Buch 03</span><span lang="en">Book 03</span></a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank" hidden><span lang="de">Buch 04</span><span lang="en">Book 04</span></a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank" hidden><span lang="de">Buch 05</span><span lang="en">Book 05</span></a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank" hidden><span lang="de">Buch 06</span><span lang="en">Book 06</span></a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank" hidden><span lang="de">Buch 07</span><span lang="en">Book 07</span></a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank" hidden><span lang="de">Buch 08</span><span lang="en">Book 08</span></a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank" hidden><span lang="de">Buch 09</span><span lang="en">Book 09</span></a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank" hidden><span lang="de">Buch 10</span><span lang="en">Book 10</span></a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank" hidden><span lang="de">Buch 11</span><span lang="en">Book 11</span></a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank" hidden><span lang="de">Buch 12</span><span lang="en">Book 12</span></a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank"><span lang="de">Buch 13</span><span lang="en">Book 13</span></a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank" hidden><span lang="de">Buch 14</span><span lang="en">Book 14</span></a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank" hidden><span lang="de">Buch 15</span><span lang="en">Book 15</span></a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank" hidden><span lang="de">Buch 16</span><span lang="en">Book 16</span></a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank" hidden><span lang="de">Buch 17</span><span lang="en">Book 17</span></a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank" hidden><span lang="de">Buch 18</span><span lang="en">Book 18</span></a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank" hidden><span lang="de">Buch 19</span><span lang="en">Book 19</span></a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank" hidden><span lang="de">Buch 20</span><span lang="en">Book 20</span></a></li>
                                                            
                                                            </ul>
                                                        </div>
                                                        </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div> 
                            
                            <!--COLUMN 2: MIRADOR VIEWER-->
                            <div class="col-sm-6">
                                <div id="mirador-singleMS"></div>
                            </div>
                        </div>

                        <div id="map2"></div>
                </div>
            </div>
            
            <div id="footer-placeholder"></div>
        </body>

        <!--Embedding map -->
        <script type="text/javascript">
        var mymap = L.map('map2').setView([48.00, 12], 5);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(mymap);
        </script>
        <script src="../js/map.js"></script>

        <!--Populate accordion in Info tab-->
        <script>
            var miradorInstance
            async function fetchDataAndPopulate() {
                let document_id = new URLSearchParams(window.location.search).get('document');
                let folderPath = '../data/mss/' + document_id + '/Tei/v1'; // Update this with your XML folder path
                let response = await fetch(folderPath + '/msdesc.xml'); // Fetch the XML file
                
                if (response.ok) {
                    const xmlText = await response.text();
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(xmlText, 'text/xml');

                    initializeMirador(document_id)

                    const msNameFull = xmlDoc.querySelectorAll('msName[type="full"]')[0].innerHTML
                    document.getElementById("ms-title").innerHTML = msNameFull

                    const msSignatur = document.createElement('div');
                    msSignatur.innerHTML += "<b><span lang='de'>Signatur: </span> <span lang='en'>Signature: </span> </b>" + xmlDoc.querySelectorAll('msName[type="full"]')[0].innerHTML +"<br/>"
                    msSignatur.innerHTML += "<b><span lang='de'>Alte Signatur: </span> <span lang='en'>Old Signature: </span> </b>"+ xmlDoc.querySelectorAll('altIdentifier[type="old-signature"] idno')[0].innerHTML +"<br/>"
                    msSignatur.innerHTML += "<b>Sigle: </b>"+ xmlDoc.querySelectorAll('msName[type="sigle"]')[0].innerHTML +"<br/>"

                    var textualFamily = xmlDoc.querySelectorAll('msItem[class="main-text"] note[type="textual-family"]');
                    var textualSubfamily = xmlDoc.querySelectorAll('msItem[class="main-text"] note[type="textual-subfamily"]');

                    var textualFamily = xmlDoc.querySelectorAll('msItem[class="main-text"] note[type="textual-family"]')[0].innerHTML.trim();
                    var textualSubfamily = xmlDoc.querySelectorAll('msItem[class="main-text"] note[type="textual-subfamily"]')[0].innerHTML.trim();
                    if (textualFamily) {
                        msSignatur.innerHTML += "<b><span lang='de'>Textfamilie (nach Hoffmann und Pokorny): </span> <span lang='en'>Text family (based on Hoffmann and Pokorny): </span> </b>" + textualFamily;
                        if (textualSubfamily) {
                            // If both textualFamily and textualSubfamily have content, add the comma
                            msSignatur.innerHTML += ", " + textualSubfamily;
                        }
                        msSignatur.innerHTML += "<br/>";
                    } 
                    else {
                        // If there is no textual content in textualFamily, only add textualSubfamily
                        msSignatur.innerHTML += "<b><span lang='de'>Textfamilie (nach Hoffmann und Pokorny): </span> <span lang='en'>Text family (based on Hoffmann and Pokorny): </span> </b>" + textualSubfamily + "<br/>";
                    }
                    document.getElementById("mss-signatur").appendChild(msSignatur)


                    const msHistory = document.createElement('div');
                    const origPlaceElement = xmlDoc.querySelector('origPlace');
                    const origPlaceText = origPlaceElement.childNodes[0].nodeValue.trim();
                    /*const origPlaceText = Array.from(origPlaceElement.childNodes)
                        .filter(node => node.nodeName !== 'location' || node.nodeName === 'location' && node.childNodes.length === 0)
                        .map(node => node.textContent.trim())
                        .join(' ');*/

                    msHistory.innerHTML += "<b><span lang='de'>Schriftheimat: </span> <span lang='en'>Origin: </span> </b>"+ origPlaceText +"<br/>";

                    msHistory.innerHTML += "<b><span lang='de'>Entstehungszeitraum: </span> <span lang='en'>Period of origin: </span> </b>"+ xmlDoc.querySelectorAll('origDate')[0].innerHTML +"<br/>"
                    msHistory.innerHTML += "<b><span lang='de'>Provenienz: </span> <span lang='en'>Provenance: </span> </b>"+ xmlDoc.querySelectorAll('provenance settlement')[0].innerHTML + ", "+
                        xmlDoc.querySelectorAll('provenance name')[0].innerHTML +"<br/>"
                    msHistory.innerHTML += "<b><span lang='de'>Zusammenfassung: </span> <span lang='en'>Summary: </span> </b>"+ xmlDoc.querySelectorAll('history summary')[0].innerHTML +"<br/>"

                    document.getElementById("mss-history").appendChild(msHistory)


                    const msDesc = document.createElement('div');

                    var materialLabel;
                    var material = xmlDoc.querySelectorAll('supportDesc')[0].getAttribute("material");

                    if (material === "parchment") {
                        materialLabel = "Pergament";
                    } else {
                        // add here other materials if need
                        // or provide a default label if no condition matches
                        materialLabel = material; // default: keep the original material
                    }
                    msDesc.innerHTML += "<b><span lang='de'>Beschreibstoff: </span> <span lang='en'>Writing medium: </span> </b>" + materialLabel + "<br/>";
                    msDesc.innerHTML += "<b><span lang='de'>Größe: </span> <span lang='en'>Size: </span>  </b>"+ xmlDoc.querySelectorAll('extent dimensions[type="leaf"] height')[0].getAttribute("quantity") + " cm x " +xmlDoc.querySelectorAll('extent dimensions[type="leaf"] width')[0].getAttribute("quantity") +"<br/>"
                    msDesc.innerHTML += "<b><span lang='de'>Blatt: </span> <span lang='en'>Sheets: </span>  </b>"+ xmlDoc.querySelectorAll('extent measure')[0].getAttribute("quantity") + "<br/>"
                    msDesc.innerHTML += "<b><span lang='de'>Layout </span> <span lang='en'>Layout: </span> : </b>"+ xmlDoc.querySelectorAll('layout')[0].getAttribute("columns") + " Spalten, " + xmlDoc.querySelectorAll('layout')[0].getAttribute("writtenLines") + " Zeilen <br/>"
                    msDesc.innerHTML += "<b><span lang='de'>Zustand: </span> <span lang='en'>Condition: </span>  </b>"+ xmlDoc.querySelectorAll('condition')[0].innerHTML +"<br/>"
                    msDesc.innerHTML += "<b><span lang='de'>Schriftbeschreibung: </span> <span lang='en'>Writing description: </span>  </b>"+ xmlDoc.querySelectorAll('scriptDesc scriptNote')[0].innerHTML +"<br/>"

                    document.getElementById("mss-desc").appendChild(msDesc)
                    
                    

                    mDescArray = xmlDoc.querySelectorAll('msContents msItem')
                    for (let i = 0; i < mDescArray.length; i++) {
                        const msContent = document.createElement('div');
                        msContent.classList.add('mb-4');
                        msContent.innerHTML += "<b>Text: </b>"+ mDescArray[i].getAttribute("n") +"<br/>"
                        var locusElements = mDescArray[i].querySelectorAll('locusGrp locus');
                        var locusString = "";
                        for (var j = 0; j < locusElements.length; j++) {
                            var locus = locusElements[j].getAttribute("from") + "-" + locusElements[j].getAttribute("to");
                            locusString += (j > 0 ? "; " : "") + locus;
                        }
                        msContent.innerHTML += "<b>Folio: </b>" + locusString + "<br/>";

                        msContent.innerHTML += "<b><span lang='de'>Titel: </span> <span lang='en'>Title: </span>  </b>"+ mDescArray[i].querySelectorAll('title')[0].innerHTML +"<br/>"
                        msContent.innerHTML += "<b><span lang='de'>Autor: </span> <span lang='en'>Author: </span>  </b>"+ mDescArray[i].querySelectorAll('author')[0].innerHTML +"<br/>"
                        msContent.innerHTML += "<b>Incipit: </b>"+ mDescArray[i].querySelectorAll('incipit')[0].innerHTML +"<br/>"
                        msContent.innerHTML += "<b>Explicit: </b>"+ mDescArray[i].querySelectorAll('explicit')[0].innerHTML +"<br/>"

                        document.getElementById("mss-content").appendChild(msContent)
                    }
                    

                    titleArray = xmlDoc.querySelectorAll('msContents msItemStruct[*|id*="modern"] msItemStruct')
                    for (let i = 0; i < titleArray.length; i++) {
                        const msContentStructModern = document.createElement('div');
                        msContentStructModern.innerHTML += "<b><span lang='de'>Titel: </span> <span lang='en'>Title: </span> </b>"+ titleArray[i].querySelectorAll('title')[0].innerHTML +"<br/>"
                        document.getElementById("mss-content-struct-modern").appendChild(msContentStructModern)
                    }


                    // Retrieve the catalogue items
                    var catalogueItems = xmlDoc.querySelectorAll('listBibl[type="catalogue"] bibl');
                    var ulElement = document.getElementById("catalogue-list");

                    catalogueItems.forEach(function(item) {
                        //var catalogueText = item.textContent;
                        // Exclude <citedRange> from catalogueText
                        var catalogueText = Array.from(item.childNodes)
                        .filter(node => node.nodeName !== 'citedRange')
                        .map(node => node.textContent.trim())
                        .join(' ')
                        .replace(/<\/citedRange>[^<]*/, ''); // Remove content after </citedRange>, including the period

                        var citedRange = item.querySelector('citedRange').textContent;
                        var copyOfValue = item.getAttribute('copyOf');
                        var finalText = catalogueText;
                        if (citedRange) {
                            finalText += ", S. " + citedRange;
                        }

                        // Create an <i> element for the link icon
                        var icon = document.createElement('i');
                        icon.className = 'fas fa-arrow-up-right-from-square fa-sm';
                        var linkElement = document.createElement('a');
                        linkElement.setAttribute('href', 'bibl.html#' + copyOfValue);
                        linkElement.setAttribute('target', '_blank');
                        linkElement.appendChild(icon);

                        // Create an <li> element to hold each literature item
                        var liElement = document.createElement('li');
                        liElement.textContent = finalText;
                        liElement.appendChild(linkElement);
                        ulElement.appendChild(liElement);
                    });


                    // Retrieve the secondary literature items
                    var literatureItems = xmlDoc.querySelectorAll('listBibl[type="secondary-literature"] bibl');
                    var ulElement = document.getElementById("literature-list");

                    literatureItems.forEach(function(item) {
                        //var literatureText = item.textContent;
                        var literatureText = Array.from(item.childNodes)
                        .filter(node => node.nodeName !== 'citedRange')
                        .map(node => node.textContent.trim())
                        .join(' ');

                        var citedRange = item.querySelector('citedRange').textContent;
                        var copyOfValue = item.getAttribute('copyOf');
                        var finalText = literatureText;
                        if (citedRange) {
                            finalText += ", S. " + citedRange;
                        }

                        // Create an <i> element for the icon
                        var icon = document.createElement('i');
                        icon.className = 'fas fa-arrow-up-right-from-square fa-sm';
                        var linkElement = document.createElement('a');
                        linkElement.setAttribute('href', 'bibl.html#' + copyOfValue);
                        linkElement.setAttribute('target', '_blank');
                        linkElement.appendChild(icon);

                        // Create an <li> element to hold each literature item
                        var liElement = document.createElement('li');
                        liElement.textContent = finalText;
                        liElement.appendChild(linkElement);
                        ulElement.appendChild(liElement);
                    });

                    document.getElementById("webResourceDigitalisat").href = xmlDoc.querySelectorAll('surrogates bibl[type="digi"] ref')[0].innerHTML
                    document.getElementById("webResourceKatalogisat").href = xmlDoc.querySelectorAll('surrogates bibl[type="cat"] ref')[0].innerHTML

                    //Book selection: display the correct number of books in V1 and V2, and K
                    var startBook = 0;
                    var endBook = 20;

                    switch(document_id) {
                        case "Va2":
                            endBook = 8;
                            break;
                        case "Va3":
                            startBook = 9;
                            break;
                        case "K":
                            startBook = 2;
                            break;
                        default:
                            break;
                    }

                    //Hide books in "XML file" dropdown list (Web resources) that are not pesent (K 00 and 01, Va2 from 09 to 20, and Va3 from 00 to 08)
                    for (var i = 0; i <= 20; i++) { 
                        document.querySelector("#collapseWebressourcen li:nth-child("+(i+1)+") a").href =  '../data/mss/' + document_id + '/Tei/v1/' + i + ".xml"
                        if(i < startBook || i > endBook){
                            document.querySelector("#collapseWebressourcen li:nth-child("+(i+1)+") a").hidden = true
                        }
                    }


                    //List of active (available) books in "Select a book" dropdown
                    const activeOptions = [13, 1]
                    for (var i = startBook; i <= endBook; i++) { 
                        var optionBook = document.createElement('option');
                        optionBook.value = (i < 10) ? "0" + i : i;
                        optionBook.innerHTML = " " + ((i < 10) ? "0" + i : i);
                        if (!activeOptions.includes(i)){
                            optionBook.disabled = true
                        }
                        document.querySelector("#book-selector").appendChild(optionBook);
                    }
                    
                checkLanguage();
                }
            }
            // Invoke the function when the page loads
            window.onload = fetchDataAndPopulate;

            //keep track of desktop.html window
            var desktopWindow = null;

            //Redirect to Schreibtisch after clicking the button
            function redirectToTranscription() {
                let selectedMs = new URLSearchParams(window.location.search).get('document');
                let selectedBook = document.querySelector("#book-selector").value;
                let selected = selectedMs + "-" + selectedBook
                if (selected) {
                    if (desktopWindow && !desktopWindow.closed) {
                        // if the window is already open
                        desktopWindow.focus();
                        // send message to desktop.html
                        desktopWindow.postMessage(selected, "*");
                    } else {
                        // if not open, open a new one
                        desktopWindow = window.open('desktop.html', '_blank');
                        desktopWindow.onload = function() {
                            desktopWindow.postMessage(selected, "*");
                        };
                    }
                }
            }

            //Mirador
            function initializeMirador(doc_id){
                const doc_sigle = { 'F':'../data/manifests/frankfurt-ub-b-50-manifest.json',
                                    'Va2': '../data/manifests/vatican-bav-pl-585-manifest.json',
                                    'Va3': '../data/manifests/vatican-bav-pl-586-manifest.json',
                                    'B' : '../data/manifests/bamberg-sb-c-6.json',
                                    'K' : '../data/manifests/koeln-edd-119-manifest.json'}
                miradorInstance = Mirador.viewer({
                    id: "mirador-singleMS",
                    language: 'de',
                    window: { //global window defaults
                        allowClose: false, // Configure if windows can be closed or not
                        defaultView: 'single',  // Configure which viewing mode (e.g. single, book, gallery) for windows to be opened in
                        highlightAllAnnotations: true, // Configure whether to display annotations on the canvas by default
                        panels: { // Configure which panels are visible in WindowSideBarButtons
                            info: true,
                            attribution: true,
                            canvas: true,
                            annotations: true,
                            search: true,
                            layers: true
                        },
                        views: [
                            { key: 'single', behaviors: ['individuals'] },
                            { key: 'book', behaviors: ['paged'] }
                            
                    ] },
                    windows: [{
                        id: 'known-window-id',
                        manifestId: doc_sigle[doc_id],
                        canvasId: ''
                    }],
                    
                    thumbnails: {
                            preferredFormats: ['jpg', 'png', 'webp', 'tif']
                            },
                    thumbnailNavigation: {
                        defaultPosition: 'far-bottom', // Which position for the thumbnail navigation to be be displayed. Other possible values are "far-bottom" or "far-right"
                        displaySettings: true // Display the settings for this in WindowTopMenu
                        },
                    catalog: [
                        { sigle: 'F', manifestId: '../data/manifests/frankfurt-ub-b-50-manifest.json' },
                        { sigle: 'Va2', manifestId: '../data/manifests/vatican-bav-pl-585-manifest.json' },
                        { sigle: 'Va3', manifestId: '../data/manifests/vatican-bav-pl-586-manifest.json'},
                        { sigle: 'B', manifestId: '../data/manifests/bamberg-sb-c-6.json'},
                        { sigle: 'K', manifestId: '../data/manifests/koeln-edd-119-manifest.json'}
                    ]
                });
            }

            document.addEventListener("DOMContentLoaded", function() {                
                var selectorContainer = document.querySelector("#book-selector").parentNode;
                document.querySelector("#book-selector").addEventListener("change", async function() {
                    document.querySelector("#addToDesk").removeAttribute('disabled');
                    let selectedMs = new URLSearchParams(window.location.search).get('document');
                    let selectedBook = document.querySelector("#book-selector").value;
                    let ms_path = '../data/mss/' + selectedMs + '/Tei/v1/' + selectedBook + ".html";
                    let response = await fetch(ms_path);
                    let htmlContent = await response.text();
                    let doc = new DOMParser().parseFromString(htmlContent, 'text/html');
                    let canvasId = doc.querySelector('[data-canvas]').getAttribute("data-canvas");

                    var action = Mirador.actions.setCanvas('known-window-id', canvasId)
                    miradorInstance.store.dispatch(action);
                    
                });
                document.querySelector("#addToDesk").addEventListener("click", function() {
                    redirectToTranscription()
                })
            });
        </script>
</html>