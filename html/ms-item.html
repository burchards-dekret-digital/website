<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml">
        <head>
            <title>BDD Handschrift</title>
            <link rel="icon" type="image/png" href="../img/favicon.png" sizes="32x32">
            <meta charset="UTF-8"/>
            <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
            <meta name="google" content="notranslate"/>    

            
            <!--Bootstrap-->
            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous"/>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script> 
            
            <!-- // CSS -->
            <link rel="stylesheet" type="text/css" href="../CSS/style.css" media="screen"/>
            <link rel="stylesheet" type="text/css" href="../CSS/transcription_view.css" media="screen"/>
            
            <!-- // External fonts -->
            <link href="https://fonts.googleapis.com/css?family=Cardo:400,700" rel="stylesheet"/>
            <link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet"/>
            <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500"/>
            
            <!-- // === Javascripts === -->
            <!-- // jquery -->
            <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>-->
            <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
        
            
            <!-- // Mirador -->
            <script src="https://unpkg.com/mirador@3.3.0/dist/mirador.min.js"></script>
            
                        
            <!-- // Leaflet-->
            <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin=""/>
            <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
            
            <!-- // Leaflet subgroup Plugin -->
            <script src="https://unpkg.com/leaflet.featuregroup.subgroup@1.0.2/dist/leaflet.featuregroup.subgroup.js"></script>
            
            <!-- // Leaflet cluster Plugin -->
            <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js" crossorigin=""></script>
            <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" crossorigin=""/>
            <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" crossorigin=""/>
            
            <!--Fontawesome-->
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer"/>
           
            <!--<script src="../js/manuscript-view.js"></script>-->
            <!--<script src="../js/manuscript-view-synopse.js"></script>-->
            <script src="../js/language.js"></script>

            <style>
                .fa-arrow-up-right-from-square {
                    margin-left: 5px;
                }
            </style>
        </head>
        <body>
            <div id="navbar-placeholder"></div>

            <div class="back-button ps-4" style="margin-top:40px;">
                <button class="btn btn-outline-secondary rounded-circle hBack" type="button"><i class="fas fa-arrow-left"></i></button>
            </div>
            
            <div class="container mss-item-view">
                <div class="mss-data">
                    
                    <!--<div class="manuscript-title">
                        <h1 style="text-transform:uppercase"><div id="ms-title"></div></h1>
                    </div>-->
                    
                    <!--<div class="row mt-5 pt-4">
                        <div class="col-md-3"></div>
                        <div class="col-md-6">
                            <div style="display: flex; align-items: center;">
                                <h4 class="mt-2 me-2" style="text-transform: uppercase;">Buch auswählen</h4>
                                <select class="form-select" id="book-selector" style="width: 20%;">
                                    <option val="" disabled="" selected=""></option>
                                </select>
                                <button id="addToDesk" type="button" class="btn btn-primary ms-3" disabled>Buch zum Schreibtisch hinzufügen</button>
                            </div>
                        </div>
                        <div class="col-md-3"></div>
                    </div>-->

                        <div class="row">
                            
                            <!--COLUMN 1: CONTENT-->
                            <div class="col-sm-6">
                                <div class="mb-3">
                                    <h1 style="text-transform:uppercase"><div id="ms-title"></div></h1>
                                </div>

                                <div class="mb-3" style="display: flex; align-items: center;">
                                    <h4 class="mt-2 me-2" style="text-transform: uppercase;">Buch auswählen</h4>
                                    <select class="form-select" id="book-selector" style="width: 20%;">
                                        <option val="" disabled="" selected=""></option>
                                    </select>
                                    <button id="addToDesk" type="button" class="btn btn-primary ms-3" disabled>Buch zum Schreibtisch hinzufügen</button>
                                </div>

                                <div class="accordion" id="accordionInfo">
                                    
                                    <!--SIGNATUR-->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingIdno">
                                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseIdno" aria-expanded="true" aria-controls="collapseIdno">
                                                <h4>SIGNATUR</h4>
                                            </button>
                                        </h2>
                                        <div id="collapseIdno" class="accordion-collapse collapse show" aria-labelledby="headingIdno">
                                            <div class="accordion-body">
                                                <div class="ms_desc">
                                                    <div id="mss-signatur"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!--GESCHICHTE-->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingGeschichte">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseGeschichte" aria-expanded="false" aria-controls="collapseGeschichte">
                                                <h4>GESCHICHTE</h4>
                                            </button>
                                        </h2>
                                        <div id="collapseGeschichte" class="accordion-collapse collapse" aria-labelledby="headingGeschichte">
                                            <div class="accordion-body">
                                                <div id="mss-history"></div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!--BESCHREIBUNG-->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingBeschreibung">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseBeschreibung" aria-expanded="false" aria-controls="collapseBeschreibung">
                                                <h4>BESCHREIBUNG</h4>
                                            </button>
                                        </h2>
                                        <div id="collapseBeschreibung" class="accordion-collapse collapse" aria-labelledby="headingBeschreibung">
                                            <div class="accordion-body">
                                                <div class="ms_desc">
                                                    <div id="mss-desc"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!--INHALT UND HINZUFÜGEN-->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingInhalt">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInhalt" aria-expanded="false" aria-controls="collapseInhalt">
                                                <h4>INHALT UND HINZUFÜGUNGEN</h4>
                                            </button>
                                        </h2>
                                        <div id="collapseInhalt" class="accordion-collapse collapse" aria-labelledby="headingInhalt">
                                            <div class="accordion-body">
                                                <div class="ms_desc">
                                                    <h5>INHALT</h5>
                                                    <div id="mss-content"></div>
                                                    
                                                    <h5>MODERNE BINDUNG</h5>
                                                    <div id="mss-content-struct-modern"></div>
                                                    
                                                    
                                                    <!--<h5>Mittelalterliche Bindung</h5>
                                                    <div data-template="app:mss-item-content-struct-medieval"/>
                                                    
                                                    <h5>Überlieferungsmuster</h5>
                                                    <p>Decret-Admonito-Seligenstadt</p>-->  
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!--KATALOGE-->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingKataloge">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseKataloge" aria-expanded="false" aria-controls="collapseKataloge">
                                                <h4>KATALOGE</h4>
                                            </button>
                                        </h2>
                                        <div id="collapseKataloge" class="accordion-collapse collapse" aria-labelledby="headingKataloge">
                                            <div class="accordion-body">
                                                <div class="ms_desc">
                                                    <div id="mss-catalogue">
                                                        <ul id="catalogue-list"></ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!--WEITERFÜHRENDE LITERATUR-->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingLiterature">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseLiterature" aria-expanded="false" aria-controls="collapseLiterature">
                                                <h4>WEITERFÜHRENDE LITERATUR</h4>
                                            </button>
                                        </h2>
                                        <div id="collapseLiterature" class="accordion-collapse collapse" aria-labelledby="headingLiterature">
                                            <div class="accordion-body">
                                                <div class="ms_desc">
                                                    <div id="mss-literature">
                                                        <ul id="literature-list"></ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!--WERESOURCEN-->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingWebressourcen">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseWebressourcen" aria-expanded="false" aria-controls="collapseWebressourcen">
                                                <h4>WEBRESOURCEN</h4>
                                            </button>
                                        </h2>
                                        <div id="collapseWebressourcen" class="accordion-collapse collapse" aria-labelledby="headingWebressourcen">
                                            <div class="accordion-body">
                                                <div class="ms_desc">
                                                    <div class="btn-group" role="group">
                                                        <a id="webResourceDigitalisat" href="" target="_blank" class="btn btn-outline-primary">Digitalisat</a>
                                                        <a id="webResourceKatalogisat" href="" target="_blank" class="btn btn-outline-primary">Katalogisat</a>
                                                        <div class="btn-group dropup" role="group">
                                                            <button type="button" class="btn btn-outline-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                                                                XML-Datei
                                                            </button>
                                                            <ul class="dropdown-menu">
                                                                <li><a class="dropdown-item" href="" target="_blank">Buch 00</a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank">Buch 01</a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank">Buch 02</a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank">Buch 03</a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank">Buch 04</a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank">Buch 05</a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank">Buch 06</a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank">Buch 07</a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank">Buch 08</a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank">Buch 09</a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank">Buch 10</a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank">Buch 11</a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank">Buch 12</a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank">Buch 13</a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank">Buch 14</a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank">Buch 15</a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank">Buch 16</a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank">Buch 17</a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank">Buch 18</a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank">Buch 19</a></li>
                                                                <li><a class="dropdown-item" href="" target="_blank">Buch 20</a></li>
                                                            
                                                            </ul>
                                                        </div>
                                                        </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div> 
                            
                            <!--COLUMN 2: MIRADOR VIEWER-->
                            <div class="col-sm-6">
                                <div id="mirador-singleMS"></div>
                            </div>
                        </div>

                        <div id="map2"></div>
                </div>
            </div>
            
            <div id="footer-placeholder"></div>
        </body>

        
        <script>
        //Display Navbar with active item
            $(function() {
                function setActiveNavItem() {
                    var path = window.location.pathname; 
                    var currentPage = path.split("/").pop();
                    $(".nav-item a").removeClass("active");
                    
                    $(".nav-item a").each(function() {
                        var href = $(this).attr("href");
                        if (href && currentPage === href.split("/").pop()) {
                            $(this).addClass("active");
                        }
                    });
                }
      
                $("#navbar-placeholder").load("navbar.html", function() {
                    setActiveNavItem();
                    checkLanguage();
                });
            });

        //Display Footer
            $(function(){
                  $("#footer-placeholder").load("footer.html", function(){checkLanguage()});
            });
        
        //back-to-top button
            $(".btn-back-to-top").click(function () {
            //html works for FFX but not Chrome
            //body works for Chrome but not FFX
            $("html, body").animate({scrollTop: 0});
            });

        //back button
            $(".hBack").on("click", function(e){
                e.preventDefault();
                window.history.back();
            });
        </script>

        

       <!--<script>
            window.addEventListener('load', function() {
            const manifestUrl = 'https://sammlungen.ub.uni-frankfurt.de/i3f/v20/2035614/manifest';
            const customWindowId = 'mss'
            
            loadManifestToMirador(manifestUrl, customWindowId);
            });
            
            function loadManifestToMirador(url, customWindowId) {
                setTimeout(() =&gt; {
                mirador.store.dispatch(Mirador.actions.addWindow({ id: customWindowId, manifestId: url }));
                }, 500);
            }
        </script>-->

        <!--Embedding map -->
        <script type="text/javascript">
        var mymap = L.map('map2').setView([48.00, 12], 5);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(mymap);
        </script>
        <script src="../js/map.js"></script>

        <!--Populate accordion in Info tab-->
        <script>
            var miradorInstance
            async function fetchDataAndPopulate() {
                let document_id = new URLSearchParams(window.location.search).get('document');
                let folderPath = '../data/mss/' + document_id + '/Tei/v1'; // Update this with your XML folder path
                let response = await fetch(folderPath + '/msdesc.xml'); // Fetch the XML file
                
                if (response.ok) {
                    const xmlText = await response.text();
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(xmlText, 'text/xml');

                    initializeMirador(document_id)

                    const msNameFull = xmlDoc.querySelectorAll('msName[type="full"]')[0].innerHTML
                    document.getElementById("ms-title").innerHTML = msNameFull

                    const msSignatur = document.createElement('div');
                    msSignatur.innerHTML += "<b>Signatur: </b>"+ xmlDoc.querySelectorAll('msName[type="full"]')[0].innerHTML +"<br/>"
                    msSignatur.innerHTML += "<b>Alte Signatur: </b>"+ xmlDoc.querySelectorAll('altIdentifier[type="old-signature"] idno')[0].innerHTML +"<br/>"
                    msSignatur.innerHTML += "<b>Sigle: </b>"+ xmlDoc.querySelectorAll('msName[type="sigle"]')[0].innerHTML +"<br/>"

                    var textualFamily = xmlDoc.querySelectorAll('msItem[class="main-text"] note[type="textual-family"]');
                    var textualSubfamily = xmlDoc.querySelectorAll('msItem[class="main-text"] note[type="textual-subfamily"]');

                    var textualFamily = xmlDoc.querySelectorAll('msItem[class="main-text"] note[type="textual-family"]')[0].innerHTML.trim();
                    var textualSubfamily = xmlDoc.querySelectorAll('msItem[class="main-text"] note[type="textual-subfamily"]')[0].innerHTML.trim();
                    if (textualFamily) {
                        msSignatur.innerHTML += "<b>Textfamilie (nach Hoffmann und Pokorny): </b>" + textualFamily;
                        if (textualSubfamily) {
                            // If both textualFamily and textualSubfamily have content, add the comma
                            msSignatur.innerHTML += ", " + textualSubfamily;
                        }
                        msSignatur.innerHTML += "<br/>";
                    } 
                    else {
                        // If there is no textual content in textualFamily, only add textualSubfamily
                        msSignatur.innerHTML += "<b>Textfamilie (nach Hoffmann und Pokorny): </b>" + textualSubfamily + "<br/>";
                    }
                    //msSignatur.innerHTML += "<b>Textfamilie (nach Hoffmann und Pokorny): </b>"+ xmlDoc.querySelectorAll('msItem[class="main-text"] note[type="textual-family"]')[0].innerHTML + ", "+
                        //xmlDoc.querySelectorAll('msItem[class="main-text"] note[type="textual-subfamily"]')[0].innerHTML +"<br/>"
                    document.getElementById("mss-signatur").appendChild(msSignatur)


                    const msHistory = document.createElement('div');
                    const origPlaceElement = xmlDoc.querySelector('origPlace');
                    const origPlaceText = Array.from(origPlaceElement.childNodes)
                        .filter(node => node.nodeName !== 'location' || node.nodeName === 'location' && node.childNodes.length === 0)
                        .map(node => node.textContent.trim())
                        .join(' ');
                    msHistory.innerHTML += "<b>Schriftheimat: </b>"+ origPlaceText +"<br/>";

                    msHistory.innerHTML += "<b>Entstehungszeitraum: </b>"+ xmlDoc.querySelectorAll('origDate')[0].innerHTML +"<br/>"
                    msHistory.innerHTML += "<b>Provenienz: </b>"+ xmlDoc.querySelectorAll('provenance settlement')[0].innerHTML + ", "+
                        xmlDoc.querySelectorAll('provenance name')[0].innerHTML +"<br/>"
                    msHistory.innerHTML += "<b>Zusammenfassung: </b>"+ xmlDoc.querySelectorAll('history summary')[0].innerHTML +"<br/>"

                    document.getElementById("mss-history").appendChild(msHistory)


                    const msDesc = document.createElement('div');

                    var materialLabel;
                    var material = xmlDoc.querySelectorAll('supportDesc')[0].getAttribute("material");

                    if (material === "parchment") {
                        materialLabel = "Pergament";
                    } else {
                        // add here other materials if need
                        // or provide a default label if no condition matches
                        materialLabel = material; // default: keep the original material
                    }
                    msDesc.innerHTML += "<b>Beschreibstoff: </b>" + materialLabel + "<br/>";
                    msDesc.innerHTML += "<b>Größe: </b>"+ xmlDoc.querySelectorAll('extent dimensions[type="leaf"] height')[0].getAttribute("quantity") + " cm x " +xmlDoc.querySelectorAll('extent dimensions[type="leaf"] width')[0].getAttribute("quantity") +"<br/>"
                    msDesc.innerHTML += "<b>Blatt: </b>"+ xmlDoc.querySelectorAll('extent measure')[0].getAttribute("quantity") + "<br/>"
                    msDesc.innerHTML += "<b>Layout: </b>"+ xmlDoc.querySelectorAll('layout')[0].getAttribute("columns") + " Spalten, " + xmlDoc.querySelectorAll('layout')[0].getAttribute("writtenLines") + " Zeilen <br/>"
                    msDesc.innerHTML += "<b>Zustand: </b>"+ xmlDoc.querySelectorAll('condition')[0].innerHTML +"<br/>"
                    msDesc.innerHTML += "<b>Schriftbeschreibung: </b>"+ xmlDoc.querySelectorAll('scriptDesc scriptNote')[0].innerHTML +"<br/>"

                    document.getElementById("mss-desc").appendChild(msDesc)
                    

                    mDescArray = xmlDoc.querySelectorAll('msContents msItem')
                    for (let i = 0; i < mDescArray.length; i++) {
                        const msContent = document.createElement('p');
                        msContent.innerHTML += "<b>Text: </b>"+ mDescArray[i].getAttribute("n") +"<br/>"
                        msContent.innerHTML += "<b>Folio: </b>"+ mDescArray[i].querySelectorAll('locusGrp locus')[0].getAttribute("from") + "-" + mDescArray[i].querySelectorAll('locusGrp locus')[0].getAttribute("to") +"<br/>"
                        msContent.innerHTML += "<b>Titel: </b>"+ mDescArray[i].querySelectorAll('title')[0].innerHTML +"<br/>"
                        msContent.innerHTML += "<b>Autor: </b>"+ mDescArray[i].querySelectorAll('author')[0].innerHTML +"<br/>"
                        msContent.innerHTML += "<b>Incipit: </b>"+ mDescArray[i].querySelectorAll('incipit')[0].innerHTML +"<br/>"
                        msContent.innerHTML += "<b>Explicit: </b>"+ mDescArray[i].querySelectorAll('explicit')[0].innerHTML +"<br/>"

                        document.getElementById("mss-content").appendChild(msContent)
                    }
                    

                    titleArray = xmlDoc.querySelectorAll('msContents msItemStruct[*|id*="modern"] msItemStruct')
                    for (let i = 0; i < titleArray.length; i++) {
                        const msContentStructModern = document.createElement('p');
                        msContentStructModern.innerHTML += "<b>Titel: </b>"+ titleArray[i].querySelectorAll('title')[0].innerHTML +"<br/>"
                        document.getElementById("mss-content-struct-modern").appendChild(msContentStructModern)
                    }


                    // Retrieve the catalogue items
                    var catalogueItems = xmlDoc.querySelectorAll('listBibl[type="catalogue"] bibl');
                    var ulElement = document.getElementById("catalogue-list");

                    catalogueItems.forEach(function(item) {
                        var catalogueText = item.textContent;
                        var citedRange = item.querySelector('citedRange').textContent;
                        var copyOfValue = item.getAttribute('copyOf');
                        var finalText = catalogueText + ", Seitenbereich: " + citedRange;

                        // Create an <i> element for the icon
                        var icon = document.createElement('i');
                        icon.className = 'fas fa-arrow-up-right-from-square';
                        var linkElement = document.createElement('a');
                        linkElement.setAttribute('href', 'bibl.html#' + copyOfValue);
                        linkElement.setAttribute('target', '_blank');
                        linkElement.appendChild(icon);

                        // Create an <li> element to hold each literature item
                        var liElement = document.createElement('li');
                        liElement.textContent = finalText;
                        liElement.appendChild(linkElement);
                        ulElement.appendChild(liElement);
                    });


                    // Retrieve the secondary literature items
                    var literatureItems = xmlDoc.querySelectorAll('listBibl[type="secondary-literature"] bibl');
                    var ulElement = document.getElementById("literature-list");

                    literatureItems.forEach(function(item) {
                        var literatureText = item.textContent;
                        var citedRange = item.querySelector('citedRange').textContent;
                        var copyOfValue = item.getAttribute('copyOf');
                        var finalText = literatureText + ", Seitenbereich: " + citedRange;

                        // Create an <i> element for the icon
                        var icon = document.createElement('i');
                        icon.className = 'fas fa-arrow-up-right-from-square';
                        var linkElement = document.createElement('a');
                        linkElement.setAttribute('href', 'bibl.html#' + copyOfValue);
                        linkElement.setAttribute('target', '_blank');
                        linkElement.appendChild(icon);

                        // Create an <li> element to hold each literature item
                        var liElement = document.createElement('li');
                        liElement.textContent = finalText;
                        liElement.appendChild(linkElement);
                        ulElement.appendChild(liElement);
                    });






                    document.getElementById("webResourceDigitalisat").href = xmlDoc.querySelectorAll('surrogates bibl[type="digi"] ref')[0].innerHTML
                    document.getElementById("webResourceKatalogisat").href = xmlDoc.querySelectorAll('surrogates bibl[type="cat"] ref')[0].innerHTML

                    for (var i = 0; i <= 20; i++) { 
                        document.querySelector("#collapseWebressourcen li:nth-child("+(i+1)+") a").href =  '../data/mss/' + document_id + '/Tei/v1/' + i + ".xml"
                    }

                    //Book selection: display the correct number of book in V1 and V2
                    var startBook = 0;
                    var endBook = 20;

                    switch(document_id) {
                        case "V1":
                            endBook = 8;
                            break;
                        case "V2":
                            startBook = 9;
                            break;
                        default:
                            break;
                    }

                    const activeOptions = [13, 6]
                    
                    for (var i = startBook; i <= endBook; i++) { 
                        document.querySelector("#collapseWebressourcen li:nth-child("+(i-startBook+1)+") a").href =  '../data/mss/' + document_id + '/Tei/v1/' + i + ".xml";
                        var optionBook = document.createElement('option');
                        optionBook.value = (i < 10) ? "0" + i : i;
                        optionBook.innerHTML = "Buch " + ((i < 10) ? "0" + i : i);
                        if (!activeOptions.includes(i)){
                            optionBook.disabled = true
                        }
                        document.querySelector("#book-selector").appendChild(optionBook);
                    }

                }
            }
            // Invoke the function when the page loads
            window.onload = fetchDataAndPopulate;

            //keep track of desktop.html window
            var desktopWindow = null;

            //Redirect to Schreibtisch after clicking the button
            function redirectToTranscription() {
                let selectedMs = new URLSearchParams(window.location.search).get('document');
                let selectedBook = document.querySelector("#book-selector").value;
                let selected = selectedMs + "-" + selectedBook
                if (selected) {
                    if (desktopWindow && !desktopWindow.closed) {
                        // if the window is already open
                        desktopWindow.focus();
                        // send message to desktop.html
                        desktopWindow.postMessage(selected, "*");
                    } else {
                        // if not open, open a new one
                        desktopWindow = window.open('desktop.html', '_blank');
                        desktopWindow.onload = function() {
                            desktopWindow.postMessage(selected, "*");
                        };
                    }
                }
            }

            //Mirador
            function initializeMirador(doc_id){
                const doc_sigle = { 'F':'../data/manifests/frankfurt-ub-b-50-manifest.json',
                                    'V1': '../data/manifests/vatican-bav-pl-585-manifest.json',
                                    'V2': '../data/manifests/vatican-bav-pl-586-manifest.json',
                                    'B' : '../data/manifests/bamberg-sb-c-6.json',
                                    'K' : '../data/manifests/koeln-edd-119-manifest.json'}
                miradorInstance = Mirador.viewer({
                    id: "mirador-singleMS",
                    language: 'de',
                    window: { //global window defaults
                        allowClose: false, // Configure if windows can be closed or not
                        defaultView: 'single',  // Configure which viewing mode (e.g. single, book, gallery) for windows to be opened in
                        highlightAllAnnotations: true, // Configure whether to display annotations on the canvas by default
                        panels: { // Configure which panels are visible in WindowSideBarButtons
                            info: true,
                            attribution: true,
                            canvas: true,
                            annotations: true,
                            search: true,
                            layers: true
                        },
                        views: [
                            { key: 'single', behaviors: ['individuals'] },
                            { key: 'book', behaviors: ['paged'] }
                            
                    ] },
                    windows: [{
                        id: 'known-window-id',
                        manifestId: doc_sigle[doc_id],
                        canvasId: ''
                    }],
                    
                    thumbnails: {
                            preferredFormats: ['jpg', 'png', 'webp', 'tif']
                            },
                    thumbnailNavigation: {
                        defaultPosition: 'far-bottom', // Which position for the thumbnail navigation to be be displayed. Other possible values are "far-bottom" or "far-right"
                        displaySettings: true // Display the settings for this in WindowTopMenu
                        },
                    catalog: [
                        { sigle: 'F', manifestId: '../data/manifests/frankfurt-ub-b-50-manifest.json' },
                        { sigle: 'V1', manifestId: '../data/manifests/vatican-bav-pl-585-manifest.json' },
                        { sigle: 'V2', manifestId: '../data/manifests/vatican-bav-pl-586-manifest.json'},
                        { sigle: 'B', manifestId: '../data/manifests/bamberg-sb-c-6.json'},
                        { sigle: 'K', manifestId: '../data/manifests/koeln-edd-119-manifest.json'}
                    ]
                });
            }

            document.addEventListener("DOMContentLoaded", function() {                
                var selectorContainer = document.querySelector("#book-selector").parentNode;
                document.querySelector("#book-selector").addEventListener("change", async function() {
                    document.querySelector("#addToDesk").removeAttribute('disabled');
                    let selectedMs = new URLSearchParams(window.location.search).get('document');
                    let selectedBook = document.querySelector("#book-selector").value;
                    let ms_path = '../data/mss/' + selectedMs + '/Tei/v1/' + selectedBook + ".html";
                    let response = await fetch(ms_path);
                    let htmlContent = await response.text();
                    let doc = new DOMParser().parseFromString(htmlContent, 'text/html');
                    let canvasId = doc.querySelector('[data-canvas]').getAttribute("data-canvas");

                    var action = Mirador.actions.setCanvas('known-window-id', canvasId)
                    miradorInstance.store.dispatch(action);
                    
                });
                document.querySelector("#addToDesk").addEventListener("click", function() {
                    redirectToTranscription()
                })
            });
            

        </script>
        
        
                                               


</html>